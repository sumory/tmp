webpackJsonp([4],{770:function(n,s){n.exports={content:["article",["div",{class:"placeholder"}],["p","lor\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5185\u7f6e\u7684",["a",{title:null,href:"https://github.com/sumory/lor/blob/master/lor/lib/middleware/session.lua"},"session\u63d2\u4ef6"],"\uff0c\u5b83\u57fa\u4e8e",["a",{title:null,href:"https://github.com/bungle/lua-resty-session"},"lua-resty-session"],"\u6765\u5b9e\u73b0session\u7ba1\u7406\u3002"],["p",["strong","\u6ce8\u610f"],":"],["ul",["li",["p","\u5728\u4f7f\u7528\u8fd9\u4e2a\u63d2\u4ef6\u65f6\uff0c\u7528\u6237\u5e94\u8be5\u5148\u4e86\u89e3",["a",{title:null,href:"https://github.com/bungle/lua-resty-session"},"lua-resty-session"],"\u7684\u76f8\u5173API\u548c\u4f7f\u7528\u65b9\u5f0f"]],["li",["p","lor\u63d0\u4f9b\u7684\u9ed8\u8ba4session\u4f7f\u7528\u4e86\u57fa\u4e8ecookie\u7684\u5b58\u50a8\u65b9\u5f0f\uff0c\u4f46\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u53ef\u80fd\u9700\u8981\u4f7f\u7528redis\u6216memcache\u7b49\u6765\u5b9e\u73b0session\u7ba1\u7406\uff0c\u8fd9\u65f6\u7528\u6237\u5e94\u81ea\u884c\u521b\u5efa\u4e00\u4e2alor\u63d2\u4ef6\u6765\u4f7f\u7528"]]],["p","lor\u63d0\u4f9b\u7684\u9ed8\u8ba4session\u7684\u4f7f\u7528\u65b9\u5f0f\u5982\u4e0b:"],["pre",{lang:"lua",highlighted:'<span class="token keyword">local</span> lor <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"lor.index"</span><span class="token punctuation">)</span>\n<span class="token keyword">local</span> app <span class="token operator">=</span> <span class="token function">lor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment" spellcheck="true">-- \u52a0\u8f7dsession\u63d2\u4ef6</span>\n<span class="token keyword">local</span> session_middleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"lor.lib.middleware.session"</span><span class="token punctuation">)</span>\napp<span class="token punctuation">:</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session_middleware</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    secret <span class="token operator">=</span> <span class="token string">"G3fu98Kor0rJrembv67fnhgl95FioRpQ"</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">-- \u52a0\u5bc6\u7528\u7684\u76d0</span>\n    timeout <span class="token operator">=</span> <span class="token number">3600</span> <span class="token comment" spellcheck="true">-- session\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a3600\u79d2</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token comment" spellcheck="true">-- \u6a21\u62dfsession\u7684\u4f7f\u7528</span>\n<span class="token comment" spellcheck="true">-- \u52a0\u8f7dsession\u63d2\u4ef6\u540e\uff0c`session`\u5bf9\u8c61\u88ab\u6ce8\u5165\u5230\u4e86`req`\u5bf9\u8c61\u91cc</span>\n\n<span class="token comment" spellcheck="true">-- \u5728session\u91cc\u8d4b\u503c</span>\napp<span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/session/set"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span>\n    <span class="token keyword">local</span> k <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>k\n    <span class="token keyword">local</span> v <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>v\n    <span class="token keyword">if</span> k <span class="token keyword">then</span>\n        req<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span>\n        res<span class="token punctuation">:</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"session saved: "</span> <span class="token operator">..</span> k <span class="token operator">..</span> <span class="token string">"->"</span> <span class="token operator">..</span> v<span class="token punctuation">)</span>\n    <span class="token keyword">else</span>\n        res<span class="token punctuation">:</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"null session key"</span><span class="token punctuation">)</span>\n    <span class="token keyword">end</span>\n<span class="token keyword">end</span><span class="token punctuation">)</span>\n\n<span class="token comment" spellcheck="true">-- \u4ecesession\u91cc\u53d6\u503c</span>\napp<span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/session/get/:key"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span>\n    <span class="token keyword">local</span> k <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>key\n    <span class="token keyword">if</span> <span class="token keyword">not</span> k <span class="token keyword">then</span>\n        res<span class="token punctuation">:</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"please input session key"</span><span class="token punctuation">)</span>\n    <span class="token keyword">else</span>\n        res<span class="token punctuation">:</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"session data: "</span> <span class="token operator">..</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">end</span>\n<span class="token keyword">end</span><span class="token punctuation">)</span>\n\n<span class="token comment" spellcheck="true">-- \u9500\u6bc1session</span>\napp<span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/session/destroy"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span>\n    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">end</span><span class="token punctuation">)</span>\n\napp<span class="token punctuation">:</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>'},["code",'local lor = require("lor.index")\nlocal app = lor()\n\n-- \u52a0\u8f7dsession\u63d2\u4ef6\nlocal session_middleware = require("lor.lib.middleware.session")\napp:use(session_middleware({\n    secret = "G3fu98Kor0rJrembv67fnhgl95FioRpQ", -- \u52a0\u5bc6\u7528\u7684\u76d0\n    timeout = 3600 -- session\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a3600\u79d2\n}))\n\n-- \u6a21\u62dfsession\u7684\u4f7f\u7528\n-- \u52a0\u8f7dsession\u63d2\u4ef6\u540e\uff0c`session`\u5bf9\u8c61\u88ab\u6ce8\u5165\u5230\u4e86`req`\u5bf9\u8c61\u91cc\n\n-- \u5728session\u91cc\u8d4b\u503c\napp:get("/session/set", function(req, res, next)\n    local k = req.query.k\n    local v = req.query.v\n    if k then\n        req.session.set(k,v)\n        res:send("session saved: " .. k .. "->" .. v)\n    else\n        res:send("null session key")\n    end\nend)\n\n-- \u4ecesession\u91cc\u53d6\u503c\napp:get("/session/get/:key", function(req, res, next)\n    local k = req.params.key\n    if not k then\n        res:send("please input session key")\n    else\n        res:send("session data: " .. req.session.get(k))\n    end\nend)\n\n-- \u9500\u6bc1session\napp:get("/session/destroy", function(req, res, next)\n    req.session.destroy()\nend)\n\napp:run()']]],meta:{title:"\u4f7f\u7528session",type:"\u9ad8\u7ea7",order:204,filename:"docs/session_usage.zh-CN.md"},toc:["ul"]}}});